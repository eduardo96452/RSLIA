<main>
    <div>
        <div [ngClass]="{
            'px-5': isLargeScreen,
            'container': !isLargeScreen
          }">
            <div class="row align-items-start">
                <div class="col-md-12">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <div class="row">
                                <div>
                                    <li class="breadcrumb-item active" aria-current="page">
                                        {{reviewData.titulo_revision}}</li>
                                </div>
                            </div>
                        </ol>
                    </nav>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col col-sm col-md-2">
                    <div class="d-flex">
                        <div class="floating-menu">
                            <!-- Descripción general -->
                            <div class="menu-item " [routerLink]="['/detalle_revision']"
                                [queryParams]="{ id: reviewId }">
                                Descripción general
                            </div>

                            <!-- Planificación -->
                            <div class="menu-item active" [routerLink]="['/planificacion']"
                                [queryParams]="{ id: reviewId }">
                                Planificación
                            </div>

                            <!-- Revisión de datos -->
                            <div class="menu-item" [routerLink]="['/estudios']" [queryParams]="{ id: reviewId }">
                                Revisión de datos
                            </div>

                            <!-- Proyección de informes -->
                            <div class="menu-item" [routerLink]="['/informes']" [queryParams]="{ id: reviewId }">
                                Proyección de informes
                            </div>
                        </div>
                    </div>
                    <br />
                </div>

                <div class="col col-sm col-md-10">
                    <div class="card">
                        <div class="card-header">
                            <ul class="nav nav-tabs" id="myTab" role="tablist">
                                <!-- Página 1 -->
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active protocolo-tab" id="tab1" data-bs-toggle="tab"
                                        data-bs-target="#pagina1" type="button" role="tab" aria-controls="pagina1"
                                        aria-selected="true">
                                        Protocolo
                                    </button>
                                </li>

                                <!-- Página 2 -->
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="tab2" data-bs-toggle="tab" data-bs-target="#pagina2"
                                        type="button" role="tab" aria-controls="pagina2" aria-selected="false">
                                        <span class="d-none d-sm-inline">Lista de verificación de evaluación de
                                            calidad</span>
                                        <span class="d-inline d-sm-none">Lista de verificación<br>de<br>evaluación de
                                            calidad</span>
                                    </button>
                                </li>
                            </ul>
                        </div>
                        <div class="card-body">
                            <div class="container">
                                <!-- Contenido de las páginas -->
                                <div class="tab-content" id="myTabContent">
                                    <!-- Contenido Página 1 -->
                                    <div class="tab-pane fade show active" id="pagina1" role="tabpanel"
                                        aria-labelledby="tab1">

                                        <p>Para continuar con los pasos de realizar una revisión sistemática de
                                            literatura, sigue estos lineamientos:</p>


                                        <div class="accordion accordion-flush" id="accordionFlushExample">

                                            <!-- Acordeon de Objetivo-->
                                            <div class="accordion-item">
                                                <h2 class="accordion-header d-flex align-items-center">
                                                    <!-- Botón del acordeón con ancho reducido -->
                                                    <button class="accordion-button collapsed" type="button"
                                                        data-bs-toggle="collapse" data-bs-target="#flush-collapseOne"
                                                        aria-expanded="false" aria-controls="flush-collapseOne"
                                                        style="background-color: #F8F8F8; flex: 7;">
                                                        <h5 class="card-title mb-0">
                                                            <i class="fa-solid fa-pencil"></i>&nbsp;1) Objetivo de la
                                                            reseña
                                                        </h5>
                                                    </button>
                                                </h2>
                                                <div id="flush-collapseOne" class="accordion-collapse collapse"
                                                    aria-labelledby="flush-headingOne"
                                                    data-bs-parent="#accordionFlushExample">
                                                    <div class="accordion-body">
                                                        <!-- Contenedor principal -->
                                                        <div class="d-flex justify-content-end">
                                                            <!-- Botón de Sugerencia IA en la fila superior -->

                                                            <button class="btn btn-warning align-self-start"
                                                                type="button" (click)="getIaSuggestion()"
                                                                onclick="event.stopPropagation();">
                                                                <i class="bi bi-bug-fill"></i>&nbsp; Generar objetivo
                                                                con IA
                                                            </button>
                                                        </div>
                                                        <!-- Contenido principal debajo, en una nueva fila -->
                                                        <div class="mt-3">
                                                            <form>
                                                                <div class="mb-3">
                                                                    <textarea class="form-control" id="description"
                                                                        rows="5" [(ngModel)]="objetivo" name="objetivo"
                                                                        maxlength="1000"
                                                                        placeholder="Ingrese un objetivo para la reseña"
                                                                        (ngModelChange)="onTextChange($event)"></textarea>
                                                                    <div class="text-end text-muted mt-1">
                                                                        <small>{{ charCount }}/800 caracteres</small>
                                                                    </div>
                                                                </div>
                                                            </form>
                                                            <div class="row mt-2">
                                                                <div class="col-auto">
                                                                    <!-- Botón para limpiar -->
                                                                    <button class="btn btn-secondary" type="button"
                                                                        (click)="clearObjetivo()">
                                                                        <i class="fa-solid fa-eraser"></i>&nbsp; Limpiar
                                                                    </button>
                                                                </div>
                                                                <div class="col text-end">
                                                                    <!-- Botón para guardar el objetivo -->
                                                                    <button class="btn btn-primary" type="button"
                                                                        (click)="saveObjective()">
                                                                        <i class="fa-solid fa-paper-plane"></i> &nbsp;
                                                                        Guardar objetivo
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Acordeon de metodologías -->
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button"
                                                        data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo"
                                                        aria-expanded="false" aria-controls="flush-collapseTwo"
                                                        style="background-color: #F8F8F8; flex: 7;">
                                                        <h5 class="card-title mb-0">
                                                            <i class="fa-solid fa-pencil"></i>&nbsp;2) Selecciona una
                                                            metodología:
                                                        </h5>
                                                    </button>
                                                </h2>
                                                <div id="flush-collapseTwo" class="accordion-collapse collapse"
                                                    data-bs-parent="#accordionFlushExample">
                                                    <div class="accordion-body">
                                                        <select class="form-select mb-4" id="paginaSelect"
                                                            [(ngModel)]="paginaSeleccionada"
                                                            (ngModelChange)="onMetodoChange($event)">
                                                            <option value="pagina1">PICO</option>
                                                            <option value="pagina2">PICOC</option>
                                                            <option value="pagina3">PICOTT</option>
                                                            <option value="pagina4">SPICE</option>
                                                        </select>


                                                        <div class="">
                                                            <!-- PICO -->
                                                            <div class="card p-3"
                                                                *ngIf="paginaSeleccionada === 'pagina1'">
                                                                <div class="container">
                                                                    <div class="row align-items-start">
                                                                        <div class="col">
                                                                            <h5>PICO</h5>
                                                                        </div>
                                                                        <div class="col text-end">
                                                                            <button class="btn btn-warning"
                                                                                type="button">
                                                                                <i class="bi bi-bug-fill"></i> &nbsp;
                                                                                Generar PICO con
                                                                                IA
                                                                            </button>
                                                                        </div>
                                                                    </div>
                                                                    <br />
                                                                    <div class="row">
                                                                        <div class="col">
                                                                            <form>
                                                                                <div class="mb-3">
                                                                                    <label class="form-label">Población
                                                                                        (P)</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        [(ngModel)]="picoP"
                                                                                        name="picoP" />
                                                                                </div>
                                                                                <div class="mb-3">
                                                                                    <label
                                                                                        class="form-label">Intervención
                                                                                        (I)</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        [(ngModel)]="picoI"
                                                                                        name="picoI" />
                                                                                </div>
                                                                                <div class="mb-3">
                                                                                    <label
                                                                                        class="form-label">Comparación
                                                                                        (C)</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        [(ngModel)]="picoC"
                                                                                        name="picoC" />
                                                                                </div>
                                                                                <div class="mb-3">
                                                                                    <label class="form-label">Resultado
                                                                                        (O)</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        [(ngModel)]="picoO"
                                                                                        name="picoO" />
                                                                                </div>
                                                                            </form>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="card-footer text-end">
                                                                    <button class="btn btn-primary" type="button"
                                                                        (click)="guardarMetodologiaPICO()">
                                                                        <i class="fa-solid fa-paper-plane"></i> &nbsp;
                                                                        Guardar
                                                                        metodología PICO
                                                                    </button>
                                                                </div>
                                                            </div>


                                                            <!-- PICOC -->
                                                            <div class="card p-3"
                                                                *ngIf="paginaSeleccionada === 'pagina2'">
                                                                <div class="container">
                                                                    <div class="row align-items-start">
                                                                        <div class="col">
                                                                            <h5>PICOC</h5>
                                                                        </div>
                                                                        <div class="col text-end">
                                                                            <button class="btn btn-warning"
                                                                                type="submit">
                                                                                <i class="bi bi-bug-fill"></i>
                                                                                &nbsp; Generar PICOC con IA
                                                                            </button>
                                                                        </div>
                                                                    </div>
                                                                    <br />
                                                                    <div class="row">
                                                                        <div class="col">
                                                                            <form>
                                                                                <div class="mb-3">
                                                                                    <label class="form-label">Población
                                                                                        (P)</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        [(ngModel)]="picocP"
                                                                                        name="picocP" />
                                                                                </div>
                                                                                <br />
                                                                                <div class="mb-3">
                                                                                    <label
                                                                                        class="form-label">Intervención
                                                                                        (I)</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        [(ngModel)]="picocI"
                                                                                        name="picocI" />
                                                                                </div>
                                                                                <br />
                                                                                <div class="mb-3">
                                                                                    <label
                                                                                        class="form-label">Comparación
                                                                                        (C)</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        [(ngModel)]="picocC"
                                                                                        name="picocC" />
                                                                                </div>
                                                                                <br />
                                                                                <div class="mb-3">
                                                                                    <label class="form-label">Resultado
                                                                                        (O)</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        [(ngModel)]="picocO"
                                                                                        name="picocO" />
                                                                                </div>
                                                                                <div class="mb-3">
                                                                                    <label class="form-label">Contexto
                                                                                        (C)</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        [(ngModel)]="picocContext"
                                                                                        name="picocContext" />
                                                                                </div>
                                                                            </form>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="card-footer text-end">
                                                                    <button class="btn btn-primary" type="button"
                                                                        (click)="guardarMetodologiaPICOC()">
                                                                        <i class="fa-solid fa-paper-plane"></i> &nbsp;
                                                                        Guardar
                                                                        metodología PICOC
                                                                    </button>
                                                                </div>
                                                            </div>

                                                            <!-- PICOTT -->
                                                            <div class="card p-3"
                                                                *ngIf="paginaSeleccionada === 'pagina3'">
                                                                <div class="container">
                                                                    <div class="row align-items-start">
                                                                        <div class="col">
                                                                            <h5>PICOTT</h5>
                                                                        </div>
                                                                        <div class="col text-end">
                                                                            <button class="btn btn-warning"
                                                                                type="submit">
                                                                                <i class="bi bi-bug-fill"></i>
                                                                                &nbsp; Generar PICOTT con IA
                                                                            </button>
                                                                        </div>
                                                                    </div>
                                                                    <br />
                                                                    <div class="row">
                                                                        <div class="col">
                                                                            <form>
                                                                                <div class="mb-3">
                                                                                    <label class="form-label">Población
                                                                                        (P)</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        [(ngModel)]="picottP"
                                                                                        name="picottP" />
                                                                                </div>
                                                                                <br />
                                                                                <div class="mb-3">
                                                                                    <label
                                                                                        class="form-label">Intervención
                                                                                        (I)</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        [(ngModel)]="picottI"
                                                                                        name="picottI" />
                                                                                </div>
                                                                                <br />
                                                                                <div class="mb-3">
                                                                                    <label
                                                                                        class="form-label">Comparación
                                                                                        (C)</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        [(ngModel)]="picottC"
                                                                                        name="picottC" />
                                                                                </div>
                                                                                <br />
                                                                                <div class="mb-3">
                                                                                    <label class="form-label">Resultado
                                                                                        (O)</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        [(ngModel)]="picottO"
                                                                                        name="picottO" />
                                                                                </div>
                                                                                <div class="mb-3">
                                                                                    <label class="form-label">Tipo de
                                                                                        pregunta (T)</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        [(ngModel)]="picottT"
                                                                                        name="picottT" />
                                                                                </div>
                                                                                <div class="mb-3">
                                                                                    <label class="form-label">Tipo de
                                                                                        articulo (T)</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        [(ngModel)]="picottT2"
                                                                                        name="picottT2" />
                                                                                </div>
                                                                            </form>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="card-footer text-end">
                                                                    <button class="btn btn-primary" type="button"
                                                                        (click)="guardarMetodologiaPICOTT()">
                                                                        <i class="fa-solid fa-paper-plane"></i> &nbsp;
                                                                        Guardar
                                                                        metodología PICOTT
                                                                    </button>
                                                                </div>
                                                            </div>

                                                            <!-- SPICE -->
                                                            <div class="card p-3"
                                                                *ngIf="paginaSeleccionada === 'pagina4'">
                                                                <div class="container">
                                                                    <div class="row align-items-start">
                                                                        <div class="col">
                                                                            <h5>SPICE</h5>
                                                                        </div>
                                                                        <div class="col text-end">
                                                                            <button class="btn btn-warning"
                                                                                type="submit">
                                                                                <i class="bi bi-bug-fill"></i>
                                                                                &nbsp; Generar SPICE con IA
                                                                            </button>
                                                                        </div>
                                                                    </div>
                                                                    <br />
                                                                    <div class="row">
                                                                        <div class="col">
                                                                            <form>
                                                                                <div class="mb-3">
                                                                                    <label class="form-label">Escenario
                                                                                        (E)</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        [(ngModel)]="spiceS"
                                                                                        name="spiceS" />
                                                                                </div>
                                                                                <br />
                                                                                <div class="mb-3">
                                                                                    <label
                                                                                        class="form-label">Perspectiva
                                                                                        (P)</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        [(ngModel)]="spiceP"
                                                                                        name="spiceP" />
                                                                                </div>
                                                                                <br />
                                                                                <div class="mb-3">
                                                                                    <label
                                                                                        class="form-label">Intervención
                                                                                        (I)</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        [(ngModel)]="spiceI"
                                                                                        name="spiceI" />
                                                                                </div>
                                                                                <br />
                                                                                <div class="mb-3">
                                                                                    <label
                                                                                        class="form-label">Comparación
                                                                                        (C)</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        [(ngModel)]="spiceC"
                                                                                        name="spiceC" />
                                                                                </div>
                                                                                <div class="mb-3">
                                                                                    <label class="form-label">Evaluación
                                                                                        (E)</label>
                                                                                    <input type="text"
                                                                                        class="form-control"
                                                                                        [(ngModel)]="spiceE"
                                                                                        name="spiceE" />
                                                                                </div>
                                                                            </form>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="card-footer text-end">
                                                                    <button class="btn btn-primary" type="button"
                                                                        (click)="guardarMetodologiaSPICE()">
                                                                        <i class="fa-solid fa-paper-plane"></i> &nbsp;
                                                                        Guardar
                                                                        metodología SPICE
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Acordeon de pregunta de investigación -->
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button"
                                                        data-bs-toggle="collapse" data-bs-target="#flush-collapseThree"
                                                        aria-expanded="false" aria-controls="flush-collapseThree"
                                                        style="background-color: #F8F8F8; flex: 7;">
                                                        <h5 class="card-title mb-0">
                                                            <i class="bi bi-key-fill"></i>&nbsp;3) Preguntas de
                                                            investigación
                                                        </h5>
                                                    </button>
                                                </h2>
                                                <div id="flush-collapseThree" class="accordion-collapse collapse"
                                                    data-bs-parent="#accordionFlushExample">
                                                    <div class="accordion-body">
                                                        <div class="d-flex justify-content-between">
                                                            <!-- Botón Agregar pregunta alineado a la derecha -->
                                                            <button class="btn btn-secondary btn-sm"
                                                                (click)="addQuestion()">
                                                                <i class="bi bi-plus"></i>&nbsp; Agregar pregunta
                                                            </button>

                                                            <!-- Botón Sugerencia IA alineado a la izquierda -->
                                                            <button class="btn btn-warning" type="submit">
                                                                <i class="bi bi-bug-fill"></i>&nbsp; Generar pregunta
                                                                con IA
                                                            </button>
                                                        </div>
                                                        <br>

                                                        <div class="container">
                                                            <div *ngFor="let question of questions" class="mb-3">
                                                                <div class="input-group mb-2">
                                                                    <input type="text" class="form-control"
                                                                        [(ngModel)]="question.value"
                                                                        placeholder="Escriba su pregunta de investigación" />
                                                                    <button *ngIf="!question.isSaved"
                                                                        class="btn btn-outline-secondary" type="button"
                                                                        (click)="cancelQuestion(question.id)">
                                                                        <i class="bi bi-x"></i>
                                                                    </button>
                                                                </div>
                                                                <div class="d-flex justify-content-end gap-2">
                                                                    <button *ngIf="!question.isSaved"
                                                                        class="btn btn-outline-primary"
                                                                        (click)="saveQuestion(question)">
                                                                        <i class="bi bi-floppy"> Guardar</i>
                                                                    </button>
                                                                    <button *ngIf="question.isSaved"
                                                                        class="btn btn-outline-danger"
                                                                        (click)="deleteQuestion(question.id)">
                                                                        <i class="bi bi-trash"> Eliminar </i>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Acordeon de palabras claves y sinonimos -->
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button"
                                                        data-bs-toggle="collapse" data-bs-target="#flush-collapseFour"
                                                        aria-expanded="false" aria-controls="flush-collapseThree"
                                                        style="background-color: #F8F8F8; flex: 7;">
                                                        <h5 class="card-title mb-0">
                                                            <i class="bi bi-key-fill"></i>&nbsp;4) Palabras claves y
                                                            sinónimos
                                                        </h5>
                                                    </button>
                                                </h2>
                                                <div id="flush-collapseFour" class="accordion-collapse collapse"
                                                    data-bs-parent="#accordionFlushExample">
                                                    <div class="accordion-body">
                                                        <div class="d-flex justify-content-between">
                                                            <!-- Botón Agregar palabra clave alineado a la derecha -->
                                                            <button class="btn btn-secondary" data-bs-toggle="modal"
                                                                (click)="addRow()" data-bs-target="#staticBackdrop"><i
                                                                    class="bi bi-plus"></i>
                                                                &nbsp;
                                                                Añadir palabra clave
                                                            </button>
                                                            <!-- Botón Sugerencia IA alineado a la izquierda -->
                                                            <button class="btn btn-warning" type="submit">
                                                                <i class="bi bi-bug-fill"></i>&nbsp; Generar sinonimos
                                                                con IA
                                                            </button>
                                                        </div>
                                                        <br>
                                                        <div class="table-responsive">
                                                            <table class="table table-bordered">
                                                                <thead>
                                                                    <tr>
                                                                        <th style="display:none;">ID</th>
                                                                        <th>Palabra Clave</th>
                                                                        <th>Relacionado</th>
                                                                        <th>Sinónimos</th>
                                                                        <th>Acciones</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr *ngFor="let row of tableData; let i = index">
                                                                        <!-- Columna oculta para ID -->
                                                                        <td style="display:none;">
                                                                            {{ row.id_palabras_clave }}
                                                                        </td>

                                                                        <!-- Palabra Clave -->
                                                                        <td>
                                                                            <input class="form-control" type="text"
                                                                                [(ngModel)]="row.keyword"
                                                                                [readonly]="!row.isEditing" />
                                                                        </td>

                                                                        <!-- Relacionado -->
                                                                        <td>
                                                                            <select class="form-select"
                                                                                [(ngModel)]="row.related"
                                                                                [disabled]="!row.isEditing">
                                                                                <option
                                                                                    *ngFor="let option of methodologies"
                                                                                    [value]="option">
                                                                                    {{ option }}
                                                                                </option>
                                                                            </select>
                                                                        </td>

                                                                        <!-- Sinónimos -->
                                                                        <td>
                                                                            <input class="form-control" type="text"
                                                                                [(ngModel)]="row.synonyms"
                                                                                [readonly]="!row.isEditing" />
                                                                        </td>

                                                                        <!-- Acciones -->
                                                                        <td>
                                                                            <!-- CASO 1: REGISTRO NUEVO => mostrar Guardar -->
                                                                            <button *ngIf="!row.id_palabras_clave"
                                                                                class="btn btn-primary btn-sm me-1"
                                                                                [disabled]="!row.isEditing"
                                                                                (click)="saveRow(row)">
                                                                                Guardar
                                                                            </button>

                                                                            <!-- CASO 2: REGISTRO EXISTENTE => mostrar Editar / Actualizar -->
                                                                            <ng-container *ngIf="row.id_palabras_clave">
                                                                                <button *ngIf="!row.isEditing"
                                                                                    class="btn btn-secondary btn-sm me-1"
                                                                                    (click)="editRow(i)">
                                                                                    Editar
                                                                                </button>

                                                                                <button *ngIf="row.isEditing"
                                                                                    class="btn btn-warning btn-sm me-1"
                                                                                    (click)="updateRow(row)">
                                                                                    Actualizar
                                                                                </button>
                                                                            </ng-container>

                                                                            <!-- Botón para eliminar, siempre accesible -->
                                                                            <button class="btn btn-danger btn-sm"
                                                                                (click)="deleteRow(i)">
                                                                                Eliminar
                                                                            </button>
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Acordeon de cadena de busqueda -->
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button"
                                                        data-bs-toggle="collapse" data-bs-target="#flush-collapseFive"
                                                        aria-expanded="false" aria-controls="flush-collapseFive"
                                                        style="background-color: #F8F8F8; flex: 7;">
                                                        <h5 class="card-title mb-0">
                                                            <i class="bi bi-stack-overflow"></i>&nbsp;5) Cadena de
                                                            búsqueda
                                                        </h5>
                                                    </button>
                                                </h2>
                                                <div id="flush-collapseFive" class="accordion-collapse collapse"
                                                    data-bs-parent="#accordionFlushExample">
                                                    <div class="accordion-body">
                                                        <!-- Contenedor principal -->
                                                        <div class="d-flex justify-content-end">
                                                            <!-- Botón de Sugerencia IA en la fila superior -->
                                                            <button class="btn btn-warning" type="button">
                                                                <i class="bi bi-bug-fill"></i>&nbsp; Generar cadena
                                                                con IA
                                                            </button>
                                                        </div>
                                                        <!-- Contenido principal debajo, en una nueva fila -->
                                                        <div class="mt-3">
                                                        </div>

                                                        <form>
                                                            <div class="mb-3">
                                                                <!-- Enlazamos con [(ngModel)]="cadenaBusqueda" -->
                                                                <textarea class="form-control" id="cadena" rows="5"
                                                                    [(ngModel)]="cadenaBusqueda" name="cadenaBusqueda"
                                                                    placeholder="Ingrese su cadena de búsqueda (use mayúsculas para AND, OR, comillas dobles, etc.)"
                                                                    maxlength="100"></textarea>

                                                                <div class="text-end text-muted mt-1">
                                                                    <small>{{ cadenaBusqueda?.length || 0 }}/100
                                                                        caracteres</small>
                                                                </div>
                                                            </div>
                                                        </form>
                                                        <div class="row mt-2">
                                                            <div class="col-auto">
                                                                <!-- Botón para limpiar -->
                                                                <button class="btn btn-secondary me-2" type="button"
                                                                    (click)="clearCadena()">
                                                                    <i class="fa-solid fa-eraser"></i>&nbsp; Limpiar
                                                                </button>
                                                            </div>
                                                            <div class="col text-end">
                                                                <!-- Botón para guardar el objetivo -->
                                                                <button class="btn btn-primary" type="button"
                                                                    (click)="saveCadena()">
                                                                    <i class="fa-solid fa-paper-plane"></i>&nbsp;
                                                                    Guardar
                                                                    cadena de
                                                                    búsqueda
                                                                </button>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Acordeon de criterios de selección -->
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button"
                                                        data-bs-toggle="collapse" data-bs-target="#flush-collapseSix"
                                                        aria-expanded="false" aria-controls="flush-collapseSix"
                                                        style="background-color: #F8F8F8; flex: 7;">
                                                        <h5 class="card-title mb-0">
                                                            <i class="bi bi-stack"></i>&nbsp;6) Criterios de selección
                                                        </h5>
                                                    </button>
                                                </h2>
                                                <div id="flush-collapseSix" class="accordion-collapse collapse"
                                                    data-bs-parent="#accordionFlushExample">
                                                    <div class="accordion-body">
                                                        <!-- Contenedor principal -->
                                                        <div class="d-flex justify-content-end">
                                                            <!-- Botón de Sugerencia IA en la fila superior -->
                                                            <button class="btn btn-warning" type="button">
                                                                <i class="bi bi-bug-fill"></i>&nbsp; Generar criterios
                                                                con IA
                                                            </button>
                                                        </div>
                                                        <!-- Contenido principal debajo, en una nueva fila -->
                                                        <div class="mt-3">
                                                            <div class="container">
                                                                <div class="row">
                                                                    <!-- Exclusiones -->
                                                                    <div class="col">
                                                                        <div class="container mt-4">
                                                                            <h2>Criterios de exclusión</h2>
                                                                            <div class="input-group mb-3">
                                                                                <input type="text" class="form-control"
                                                                                    placeholder="Ingrese un elemento para excluir"
                                                                                    [(ngModel)]="exclusionValue"
                                                                                    name="exclusionValue" />
                                                                                <button type="button"
                                                                                    class="btn btn-secondary"
                                                                                    (click)="addExclusion()">
                                                                                    <i class="bi bi-plus"></i>&nbsp;
                                                                                    Agregar
                                                                                </button>
                                                                            </div>

                                                                            <table class="table table-bordered">
                                                                                <thead>
                                                                                    <tr>
                                                                                        <th>Excluidos</th>
                                                                                        <th>Acción</th>
                                                                                    </tr>
                                                                                </thead>
                                                                                <tbody>
                                                                                    <tr
                                                                                        *ngFor="let crit of exclusions; let i = index">
                                                                                        <td>
                                                                                            <div
                                                                                                *ngIf="!crit.isEditing; else editExcl">
                                                                                                {{ crit.descripcion }}
                                                                                            </div>
                                                                                            <!-- Template para edición -->
                                                                                            <ng-template #editExcl>
                                                                                                <input
                                                                                                    class="form-control"
                                                                                                    [(ngModel)]="crit.descripcion" />
                                                                                            </ng-template>
                                                                                        </td>
                                                                                        <td>
                                                                                            <!-- Botón Editar / Actualizar -->
                                                                                            <button
                                                                                                *ngIf="!crit.isEditing"
                                                                                                class="btn btn-sm btn-warning me-1"
                                                                                                (click)="editExclusion(i)">
                                                                                                <i
                                                                                                    class="bi bi-pencil-fill"></i>
                                                                                            </button>
                                                                                            <button
                                                                                                *ngIf="crit.isEditing"
                                                                                                class="btn btn-sm btn-success me-1"
                                                                                                (click)="updateExclusion(i)">
                                                                                                <i
                                                                                                    class="bi bi-save"></i>
                                                                                            </button>

                                                                                            <!-- Botón Eliminar -->
                                                                                            <button
                                                                                                class="btn btn-danger btn-sm"
                                                                                                (click)="removeExclusion(i)">
                                                                                                <i class="bi bi-x"></i>
                                                                                            </button>
                                                                                        </td>
                                                                                    </tr>
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                    </div>

                                                                    <!-- Inclusiones -->
                                                                    <div class="col">
                                                                        <div class="container mt-4">
                                                                            <h2>Criterios de inclusión</h2>
                                                                            <div class="input-group mb-3">
                                                                                <input type="text" class="form-control"
                                                                                    placeholder="Ingrese un elemento para incluir"
                                                                                    [(ngModel)]="inclusionValue"
                                                                                    name="inclusionValue" />
                                                                                <button type="button"
                                                                                    class="btn btn-secondary"
                                                                                    (click)="addInclusion()">
                                                                                    <i class="bi bi-plus"></i>&nbsp;
                                                                                    Agregar
                                                                                </button>
                                                                            </div>

                                                                            <table class="table table-bordered">
                                                                                <thead>
                                                                                    <tr>
                                                                                        <th>Incluidos</th>
                                                                                        <th>Acción</th>
                                                                                    </tr>
                                                                                </thead>
                                                                                <tbody>
                                                                                    <tr
                                                                                        *ngFor="let crit of inclusions; let i = index">
                                                                                        <td>
                                                                                            <div
                                                                                                *ngIf="!crit.isEditing; else editIncl">
                                                                                                {{ crit.descripcion }}
                                                                                            </div>
                                                                                            <ng-template #editIncl>
                                                                                                <input
                                                                                                    class="form-control"
                                                                                                    [(ngModel)]="crit.descripcion" />
                                                                                            </ng-template>
                                                                                        </td>
                                                                                        <td>
                                                                                            <!-- Botón Editar / Actualizar -->
                                                                                            <button
                                                                                                *ngIf="!crit.isEditing"
                                                                                                class="btn btn-sm btn-warning me-1"
                                                                                                (click)="editInclusion(i)">
                                                                                                <i
                                                                                                    class="bi bi-pencil-fill"></i>
                                                                                            </button>
                                                                                            <button
                                                                                                *ngIf="crit.isEditing"
                                                                                                class="btn btn-sm btn-success me-1"
                                                                                                (click)="updateInclusion(i)">
                                                                                                Actualizar
                                                                                            </button>

                                                                                            <!-- Botón Eliminar -->
                                                                                            <button
                                                                                                class="btn btn-danger btn-sm"
                                                                                                (click)="removeInclusion(i)">
                                                                                                X
                                                                                            </button>
                                                                                        </td>
                                                                                    </tr>
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>




                                    <!-- Contenido Página 2 -->
                                    <div class="tab-pane fade" id="pagina2" role="tabpanel" aria-labelledby="tab2">
                                        <!-- Tarjeta de Preguntas -->

                                        <p>
                                            En esta sección, se crearán las preguntas que se utilizarán para evaluar los
                                            artículos aceptados en la sección correspondiente. Estas preguntas serán
                                            clave para analizar aspectos específicos de los artículos, como su
                                            relevancia, calidad metodológica, resultados y contribuciones al área de
                                            estudio.
                                        </p>

                                        <div class="card mb-4">
                                            <div class="card-header p-3">
                                                <h4 class="card-title mb-0">
                                                    <i class="bi bi-question-circle"></i> Preguntas de evaluación de
                                                    calidad
                                                </h4>
                                            </div>
                                            <div class="card-body">
                                                <button class="btn btn-primary mb-3" (click)="addQuestion1()">
                                                    <i class="bi bi-plus-circle"></i> Añadir pregunta
                                                </button>
                                                <ul class="list-group">
                                                    <li *ngFor="let question1 of questions1; let i = index"
                                                        class="list-group-item d-flex justify-content-between align-items-center">
                                                        <span>{{ question1.descripcion }}</span>
                                                        <div>
                                                            <button class="btn btn-warning btn-sm me-2"
                                                                (click)="editQuestion1(i)">
                                                                <i class="bi bi-pencil-square"></i> Editar
                                                            </button>
                                                            <button class="btn btn-danger btn-sm"
                                                                (click)="deleteQuestion1(i)">
                                                                <i class="bi bi-trash"></i> Eliminar
                                                            </button>
                                                        </div>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>

                                        <!-- Tarjeta de Respuestas -->
                                        <div class="card mb-4">
                                            <div class="card-header p-3">
                                                <h4 class="card-title mb-0">
                                                    <i class="bi bi-check-circle"></i> Respuestas de evaluación
                                                </h4>
                                            </div>
                                            <div class="card-body">
                                                <!-- Botón para crear una fila nueva en modo edición -->
                                                <button class="btn btn-primary mb-3" (click)="addLocalAnswer()">
                                                    <i class="bi bi-plus-circle"></i> Añadir respuesta
                                                </button>

                                                <table class="table table-bordered">
                                                    <thead>
                                                        <tr>
                                                            <th>Descripción</th>
                                                            <th>Peso</th>
                                                            <th>Acción</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr *ngFor="let answer1 of answers1; let i = index">
                                                            <!-- Columna Descripción -->
                                                            <td>
                                                                <!-- Si está en edición, muestra un input; si no, muestra el texto -->
                                                                <ng-container *ngIf="answer1.isEditing; else showDesc">
                                                                    <input type="text"
                                                                        class="form-control form-control-sm"
                                                                        [(ngModel)]="answer1.descripcion" />
                                                                </ng-container>
                                                                <ng-template #showDesc>
                                                                    {{ answer1.descripcion }}
                                                                </ng-template>
                                                            </td>

                                                            <!-- Columna Peso -->
                                                            <td>
                                                                <!-- Si está en edición => input editable, de lo contrario input readOnly -->
                                                                <input type="number"
                                                                    class="form-control form-control-sm"
                                                                    [(ngModel)]="answer1.peso"
                                                                    [readonly]="!answer1.isEditing" />
                                                            </td>

                                                            <!-- Columna Acción -->
                                                            <td>
                                                                <!-- CASO 1: Fila en modo edición, y no tiene ID => Botón verde "Guardar" para nueva respuesta -->
                                                                <button
                                                                    *ngIf="answer1.isEditing && !answer1.id_respuesta"
                                                                    class="btn btn-success btn-sm me-2"
                                                                    (click)="saveNewAnswer(i)">
                                                                    <i class="bi bi-check-square"></i> Guardar
                                                                </button>

                                                                <!-- CASO 2: Fila en modo edición, pero ya existe (id_respuesta) => Botón verde "Guardar" para update -->
                                                                <button
                                                                    *ngIf="answer1.isEditing && answer1.id_respuesta"
                                                                    class="btn btn-success btn-sm me-2"
                                                                    (click)="updateAnswer1(i)">
                                                                    <i class="bi bi-check-square"></i> Guardar
                                                                </button>

                                                                <!-- CASO 3: Fila sin edición => Botón amarillo "Editar" -->
                                                                <button *ngIf="!answer1.isEditing"
                                                                    class="btn btn-warning btn-sm me-2"
                                                                    (click)="editAnswer1(i)">
                                                                    <i class="bi bi-pencil-square"></i> Editar
                                                                </button>

                                                                <!-- Botón Eliminar en todos los casos -->
                                                                <button class="btn btn-danger btn-sm"
                                                                    (click)="deleteAnswer1(i)">
                                                                    <i class="bi bi-trash"></i> Eliminar
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>


                                        <!-- Tarjeta de Puntuaciones -->
                                        <div class="card mb-4">
                                            <div class="card-header p-3">
                                                <h4 class="card-title mb-0">
                                                    <i class="bi bi-bar-chart"></i> Puntuaciones de evaluación de
                                                    calidad
                                                </h4>
                                            </div>
                                            <div class="card-body">
                                                <div class="row mb-3">
                                                    <!-- Puntuación Máxima -->
                                                    <div class="col-md-6">
                                                        <label for="maxScore" class="form-label">Puntuación
                                                            máxima</label>
                                                        <input type="number" id="maxScore" class="form-control"
                                                            value="3.0" readonly />
                                                    </div>
                                                    <!-- Puntuación Límite -->
                                                    <div class="col-md-6">
                                                        <label for="limitScore" class="form-label">Puntuación
                                                            límite</label>
                                                        <div class="input-group">
                                                            <input type="number" id="limitScore" class="form-control"
                                                                [(ngModel)]="limitScore1" />
                                                            <button class="btn btn-primary" (click)="saveLimitScore()">
                                                                Guardar
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<br />
<div class="container text-center">
    <div class="row">
        <div class="col align-self-center">
            <!-- Botón para volver al inicio -->
            <button class="btn btn-primary text-center" (click)="scrollToTop()">
                <i class="bi bi-arrow-up-circle"></i>&nbsp; Subir </button>
        </div>
    </div>
</div>